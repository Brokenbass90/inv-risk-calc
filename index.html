<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Калькулятор объёма INV</title>
<style>
:root{
  --bg:#0b0f14;--card:#121821;--line:#1f2b3a;--text:#e9f1f7;--muted:#8aa1b3;--accent:#31c48d;
  --fs:clamp(14px,3.6vw,16px);--fs-lg:clamp(16px,4.4vw,18px);--rad:14px;
}
*{box-sizing:border-box;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto;outline:none}
html,body{height:100%}
body{margin:0;background:linear-gradient(180deg,#0b0f14,#0a0d12);color:var(--text);-webkit-tap-highlight-color:transparent}
.wrap{max-width:min(720px,100%);padding:clamp(12px,4vw,20px);margin:0 auto}
h1{margin:6px 0 12px;font-size:clamp(20px,5.2vw,24px)}
.card{background:var(--card);border:1px solid var(--line);border-radius:var(--rad);padding:clamp(12px,3.6vw,16px);margin-bottom:12px}
label{display:block;color:var(--muted);font-size:var(--fs);margin:8px 0 6px}
input{width:100%;padding:14px 12px;border-radius:12px;border:1px solid var(--line);background:#0e141c;color:var(--text);font-size:var(--fs-lg);-webkit-appearance:none}
input:focus{border-color:#2b9bff}
.row{display:flex;flex-direction:column;gap:10px}
@media(min-width:560px){.row{flex-direction:row}.row>div{flex:1}}
.kv{display:flex;justify-content:space-between;align-items:center;background:#0e141c;border:1px solid var(--line);border-radius:12px;padding:14px 12px;margin-top:8px}
.big{font-size:clamp(20px,5.4vw,26px);font-weight:800;color:var(--accent)}
.badge{background:#0e141c;border:1px solid var(--line);border-radius:999px;padding:4px 10px;color:var(--accent);font-size:12px;white-space:nowrap}
.headline{display:flex;align-items:center;justify-content:space-between}
.btn{cursor:pointer;border:none;background:#1b2735;color:#cfe7ff;border:1px solid var(--line);padding:14px;border-radius:12px;width:100%;font-size:var(--fs-lg);margin-top:10px;touch-action:manipulation}
.note{color:var(--muted);font-size:12px;margin-top:8px;line-height:1.45}
.err{color:#ff6b6b;font-size:12px;margin-top:6px}
</style>
</head>
<body>
<div class="wrap">
  <h1>Калькулятор объёма INV</h1>

  <div class="card">
    <label>Депозит, $</label>
    <input id="dep" inputmode="decimal" value="1000">

    <div class="row">
      <div>
        <div class="headline"><label>Риск на сделку, %</label><span id="riskUsd" class="badge">$0.00</span></div>
        <input id="riskPct" inputmode="decimal" value="1">
      </div>
      <div>
        <label>Стоп, %</label>
        <input id="stopPct" inputmode="decimal" value="0.76">
      </div>
    </div>

    <label>Плечо (если нужно снизить маржу)</label>
    <input id="lev" inputmode="decimal" value="10">

    <div id="err" class="err"></div>
  </div>

  <div class="card">
    <div class="kv"><span>Сумма в сделку</span><span id="notional" class="big">$0.00</span></div>
    <div class="kv"><span>Маржа при плече</span><b id="margin">$0.00</b></div>
    <button class="btn" id="copyN">Копировать сумму</button>
    <div class="note">Плечо влияет только на маржу. Риск в $ задаёт стоп. Вводи стоп-процент ровно как показывает рамка на графике.</div>
  </div>
</div>

<script>
const $=s=>document.querySelector(s)
const nf2=new Intl.NumberFormat('ru-RU',{minimumFractionDigits:2,maximumFractionDigits:2})
function num(v){return Number(String(v).replace(/\s/g,'').replace(',','.'))||0}
function calc(){
  const dep=num($('#dep').value)
  const rPct=num($('#riskPct').value)/100
  const dPct=num($('#stopPct').value)/100
  const L=Math.max(1,num($('#lev').value)||1)
  const R=dep*rPct
  $('#riskUsd').textContent='$'+nf2.format(R)
  $('#err').textContent=''
  if(dep<=0||rPct<=0||dPct<=0){out(0,0);return}
  const N=R/dPct
  const M=N/L
  $('#notional').textContent='$'+nf2.format(N)
  $('#margin').textContent='$'+nf2.format(M)
}
function out(N,M){
  $('#notional').textContent='$'+nf2.format(N)
  $('#margin').textContent='$'+nf2.format(M)
}
document.addEventListener('input',e=>{if(e.target.matches('input'))calc()})
$('#copyN').addEventListener('click',()=>navigator.clipboard.writeText($('#notional').textContent.replace(/\u00A0/g,' ')))
calc()
</script>
</body>
</html>
